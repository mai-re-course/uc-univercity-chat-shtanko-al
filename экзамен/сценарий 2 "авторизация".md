# сценарий 2 "авторизация"

## Акторы:

* пользователь приложения, далее *пользователь*
* пользователь прошедший авторизацию, далее *авторизированный пользователь*
* мобильное приложение, далее *приложение*
* система обслуживающая вызовы приложения, далее *бэкенд*
* оператор сотовой связи, далее *оператор*
* совместная работа приложения и бэкенда, далее *система*

## Начальные условия: пользователь выбрал пункт **авторизация** в сценарии 1 или 1.1

## Основной сценарий:

1. Приложение выводит форму авторизации
2. Пользователь вводит свои учетные данные в приложении.
3. Приложение создает хеш из введенных данных и отсылает его бэкенду, методом POST.
4. Бэкенд проверяет наличие такого хеша в базе пользователей.
5. При нахождении совпадения бэкенд отправляет ответ Ок приложению.
6. Бэкенд генерирует код для СМС, сохраняет его в кеше, на определенное время (примерно 10 мин).
7. Бэкенд отправляет оператору запрос (если связь по http, то методом POST) на отправку сообщения СМС с кодом на номер привязанный к этой учетной записи.
8. Приложение сообщает пользователю, что его учетные данные верны и для дальнейшей авторизации необходимо ввести пароль из СМС.
Время ввода СМС ограниченно, примерно 10 мин.
9. Оператор отправляет пользователю СМС.
10. Пользователь вводит в приложение пароль из СМС.
11. Приложение отправляет введенный пароль бэкенду методом POST. (надоли хешировать?)
12. Бэкенд проверяет совпадение пароля от приложения и сохраненный пароль в кеше.
13. При совпадении, сессии пользователя присваивается статус "авторизированный пользователь" и отправляется ответ Ок приложению
14. Приложение уведомляет пользователя, то он прошел авторизацию и может воспользоваться всеми разделами приложения

## Результат:
Пользователь становиться авторизированным и может воспользоваться всеми разделами приложения.

## Исключения

5.1. Если совпадения нет, то бэкенд отправит ответ приложению об ошибке. 
5.2. Приложение уведомит пользователя, что учетные данные введены не верно и предложит ввести заново или зарегистрироваться, если пользователь не зарегистрирован. 
12.1. Если пароль из СМС не совпадает с паролем из кеша или время ввода пароля превышенно, то бэкенд ответит приложению об ощибке. 
12.2. Приложение уведомит пользоввателя что пароль из СМС введен не верно или превышенно время. 
12.3. Приложение предложит еще раз ввести пароль из нового СМС, и предупредит, что осталось две попытки.

[https://drive.google.com/file/d/1y0vEV_mg8H7Tmdkq-D1J6y2o7f6hoEM7/view?usp=sharing](активити диаграмма)
