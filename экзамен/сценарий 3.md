# сценарий 2 "авторизация"

## Акторы:

* пользователь приложения, далее *пользователь*
* пользователь прошедший авторизацию, далее *авторизированный пользователь*
* мобильное приложение, далее *приложение*
* система обслуживающая вызовы приложения, далее *бэкенд*
* оператор сотовой связи, далее *оператор*
* совместная работа приложения и бэкенда, далее *система*

## Начальные условия: пользователь выбрал пункт **авторизация** в сценарии 1 или 1.1

## Основной сценарий:

1. Пользователь вводит свои учетные данные в приложении.
2. Приложение создает хеш из введенных данных и отсылает его бэкенду, методом POST.
3. Бэкенд проверяет наличие такого хеша в базе.
4. При нахождении совпадения бэкенд отправляет ответ Ок приложению. (Альтернативный сценарий а.4)
5. Бэкенд генерирует код для СМС, сохраняет его в кеше, на определенное время (примерно 10 мин).
6. Бэкенд отправляет оператору запрос (если связь по http, то методом POST) на отправку сообщения СМС с кодом на номер привязанный к этой учетной записи.
7. Приложение сообщает пользователю, что его учетные данные верны и для дальнейшей авторизации необходимо ввести пароль из СМС.
Время ввода СМС ограниченно, примерно 10 мин.
8. Оператор отправляет пользователю СМС.
9. Пользователь вводит в приложение пароль из СМС.
10. Приложение отправляет введенный пароль бэкенду методом POST.
11. Бэкенд проверяет совпадение пароля от приложения и сохраненный пароль в кеше (Альтернативный сценарий а.11)
12. При совпадении, сессии пользователя присваивается статус "авторизированный пользователь" и отправляется ответ Ок приложению
13. Приложение уведомляет пользователя, то он прошел авторизацию и может воспользоваться всеми разделами приложения


## Альтернативные сценарии
а.3. Пользователь не соглашается на авторизацию и продолжает работу в разделах не требующих авторизацию.
а.4. Если сценарий 4 завершился неудачей, то приложение сделает запрос на повторную авторизацию. 
а.4.1. Если пользователь не соглашается на повторную авторизацию, то продолжает работу в разделах не требующих авторизацию. 
а.4.2. Если пользователь соглашается на повторную авторизацию, то переходит в основной сценарий пункт 4.
